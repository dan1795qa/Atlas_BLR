#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü —Ä–∞–π–æ–Ω–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Ä–∞–π–æ–Ω–æ–≤.geojson
–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Ö –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–∞–º.
"""

import json
import os
from collections import defaultdict

def load_boundaries():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞."""
    path = r'c:\Users\HP PAVILION\Desktop\map\geojson\–≥—Ä–∞–Ω–∏—Ü—ã —Ä–∞–π–æ–Ω–æ–≤.geojson'
    with open(path, 'r', encoding='utf-8') as f:
        return json.load(f)

def extract_district_boundaries(geojson_data):
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥–æ–≥–æ —Ä–∞–π–æ–Ω–∞ –∏–∑ GeoJSON."""
    districts_by_region = defaultdict(list)
    
    # –°–ª–æ–≤–∞—Ä—å: —Ä–µ–≥–∏–æ–Ω ‚Üí —Å–ø–∏—Å–æ–∫ –µ–≥–æ —Ä–∞–π–æ–Ω–æ–≤ (–∫–∞–∫ –æ–Ω–∏ –Ω–∞–∑–≤–∞–Ω—ã –≤ —Ñ–∞–π–ª–µ –≥—Ä–∞–Ω–∏—Ü)
    regions_with_districts = {
        '–ú–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–ú–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–æ—Ä–∏—Å–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î–∑–µ—Ä–∂–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ú–æ–ª–æ–¥–µ—á–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–º–æ–ª–µ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–æ–ª–∏–≥–æ—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–°–ª—É—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–æ–ø—ã–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–õ–æ–≥–æ–π—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–£–∑–¥–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü—É—Ö–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°—Ç–∞—Ä–æ–¥–æ—Ä–æ–∂—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ö–ª–µ—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–°—Ç–æ–ª–±—Ü–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–í–∏–ª–µ–π—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–í–æ–ª–æ–∂–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö—Ä—É–ø—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–µ—Ä–µ–∑–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–õ—é–±–∞–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ú—è–¥–µ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ù–µ—Å–≤–∏–∂—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ß–µ—Ä–≤–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ],
        '–ë—Ä–µ—Å—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–ë—Ä–µ—Å—Ç—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–∞—Ä–∞–Ω–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ö–æ–±—Ä–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ì–∞–Ω—Ü–µ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î—Ä–æ–≥–∏—á–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ñ–∞–±–∏–Ω–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ò–≤–∞–Ω–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–∞–º–µ–Ω–µ—Ü–∫–∏–π —Ä–∞–π–æ–Ω',
            '–õ—É–Ω–∏–Ω–µ—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–ú–∞–ª–æ—Ä–∏—Ç—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–µ—Ä—ë–∑–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–í–æ—Ä–æ–Ω–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü—Ä—É–∂–∞–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°—Ç–æ–ª–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ò–≤–∞—Ü–µ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ],
        '–í–∏—Ç–µ–±—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–í–∏—Ç–µ–±—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü–æ–ª–æ—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–í–µ—Ä—Ö–Ω–µ–¥–≤–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–í–µ—Ç–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ì–ª—É–±–æ–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î–æ–∫—à–∏—Ü–∫–∏–π —Ä–∞–π–æ–Ω',
            '–õ–µ–ø–µ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–û—Ä—à–∞–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü–æ—Å—Ç–∞–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–†–æ—Å—Å–æ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–µ–Ω–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–¢–æ–ª–æ—á–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–£—à–∞—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–®—É–º–∏–ª–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë—Ä–∞—Å–ª–∞–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ì–æ—Ä–æ–¥–æ–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ú–∏–æ—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–õ–∏–æ–∑–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ë–µ—à–µ–Ω–∫–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ß–∞—à–Ω–∏–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü–∏—Ä—É–≥—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ],
        '–ì–æ–º–µ–ª—å—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–ì–æ–º–µ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î–æ–±—Ä—É—à—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ï–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ñ–ª–æ–±–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–æ—Ä–º—è–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–õ–æ–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–õ–µ–ª—å—á–∏—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–ú–æ–∑—ã—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ü–µ—Ç—Ä–∏–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–†–æ–≥–∞—á—ë–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–≤–µ—Ç–ª–æ–≥–æ—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ß–µ—Ä–∏–∫–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ë—É–¥–∞-–ö–æ—à–µ–ª—ë–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö—Ä–∞—Å–Ω–æ–ø–æ–ª—å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–†–µ—á–∏—Ü–∫–∏–π —Ä–∞–π–æ–Ω',
            '–î—Ä–∏–±–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î—É–±—Ä–æ–≤–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ß–µ—á–µ—Ä—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–•–æ–π–Ω–∏–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë—Ä–∞–≥–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ù–∞—Ä–æ–≤–ª—è–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ],
        '–ì—Ä–æ–¥–Ω–µ–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–ì—Ä–æ–¥–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–µ—Ä–µ—Å—Ç–æ–≤–∏—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–í–æ–ª–∫–æ–≤—ã—Å—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ó–µ–ª—å–≤–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–õ–∏–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ú–æ—Å—Ç–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ù–æ–≤–æ–≥—Ä—É–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–û—à–º—è–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–≤–∏—Å–ª–æ—á—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–°–º–æ—Ä–≥–æ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–©—É—á–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–ª–æ–Ω–∏–º—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–î—è—Ç–ª–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–æ—Ä–µ–ª–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ò–≤—å–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ],
        '–ú–æ–≥–∏–ª–µ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å': [
            '–ú–æ–≥–∏–ª—ë–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë–æ–±—Ä—É–π—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ë—ã—Ö–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ì–ª—É—Å—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ì–æ—Ä–µ—Ü–∫–∏–π —Ä–∞–π–æ–Ω', '–û—Å–∏–ø–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ú—Å—Ç–∏—Å–ª–∞–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–∏—Ä–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö—Ä–∏—á–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ö–æ—Å—Ç—é–∫–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–•–æ—Ç–∏–º—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ß–∞—É—Å—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ë–µ–ª—ã–Ω–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö–ª–∏–º–æ–≤–∏—á—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–ö—Ä—É–≥–ª—è–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–ö–ª–∏—á–µ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–®–∫–ª–æ–≤—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–°–ª–∞–≤–≥–æ—Ä–æ–¥—Å–∫–∏–π —Ä–∞–π–æ–Ω',
            '–õ–∏–æ–∑–Ω–µ–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–õ–µ–Ω–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω', '–î—Ä–∏–±–∏–Ω—Å–∫–∏–π —Ä–∞–π–æ–Ω'
        ]
    }
    
    # –û–±—Ä–∞—Ç–Ω–æ–µ –º–∞–ø–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ä–∞–π–æ–Ω ‚Üí —Ä–µ–≥–∏–æ–Ω
    district_to_region = {}
    for region, districts in regions_with_districts.items():
        for district in districts:
            district_to_region[district] = region
    
    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º features
    for feature in geojson_data.get('features', []):
        props = feature.get('properties', {})
        name = (props.get('NAME') or '').strip()
        
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ —ç—Ç–æ –ë–µ–ª–∞—Ä—É—Å—å —Ü–µ–ª–∏–∫–æ–º –∏–ª–∏ –Ω–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è
        if not name or name == '–ë–µ–ª–∞—Ä—É—Å—å':
            continue
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –Ω–∞—à–µ–º –º–∞–ø–ø–∏–Ω–≥–µ
        if name in district_to_region:
            region = district_to_region[name]
            feature_to_add = {
                'type': 'Feature',
                'properties': {
                    'name': name.replace(' —Ä–∞–π–æ–Ω', '').strip(),  # –£–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ "—Ä–∞–π–æ–Ω"
                    'district': name.replace(' —Ä–∞–π–æ–Ω', '').strip(),
                    'region': region,
                    'type': 'district'
                },
                'geometry': feature.get('geometry')
            }
            districts_by_region[region].append(feature_to_add)
            print(f"‚úì {name} ‚Üí {region}")
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –≥–æ—Ä–æ–¥–∞ –∏ –æ–±–ª–∞—Å—Ç–∏
        elif '–æ–±–ª–∞—Å—Ç—å' in name or name in ['–ú–∏–Ω—Å–∫', '–ë—Ä–µ—Å—Ç', '–ì—Ä–æ–¥–Ω–æ', '–í–∏—Ç–µ–±—Å–∫', '–ú–æ–≥–∏–ª—ë–≤', '–ì–æ–º–µ–ª—å', '–ë–æ—Ä–∏—Å–æ–≤', '–ñ–æ–¥–∏–Ω–æ', '–ù–æ–≤–æ–ø–æ–ª–æ—Ü–∫', '–ë–æ–±—Ä—É–π—Å–∫', '–û—Ä—à–∞', '–ü–æ–ª–æ—Ü–∫', '–õ–∏–¥–∞', '–ë–∞—Ä–∞–Ω–æ–≤–∏—á–∏', '–ü–∏–Ω—Å–∫']:
            print(f"‚äò {name} (–ø—Ä–æ–ø—É—â–µ–Ω: –≥–æ—Ä–æ–¥/–æ–±–ª–∞—Å—Ç—å)")
    
    return districts_by_region

def create_regional_geojson(region_name, districts):
    """–°–æ–∑–¥–∞–µ—Ç GeoJSON FeatureCollection –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞."""
    return {
        'type': 'FeatureCollection',
        'name': region_name,
        'features': districts
    }

def save_regional_files(districts_by_region):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º."""
    base_path = r'c:\Users\HP PAVILION\Desktop\map\geojson'
    
    for region_name, districts in sorted(districts_by_region.items()):
        file_path = os.path.join(base_path, f'{region_name}.geojson')
        geojson = create_regional_geojson(region_name, districts)
        
        with open(file_path, 'w', encoding='utf-8') as f:
            json.dump(geojson, f, ensure_ascii=False, indent=2)
        
        print(f"\n‚úÖ {region_name}: {len(districts)} —Ä–∞–π–æ–Ω–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ")

def main():
    print("üìç –ó–∞–≥—Ä—É–∂–∞—é –≥—Ä–∞–Ω–∏—Ü—ã —Ä–∞–π–æ–Ω–æ–≤...\n")
    geojson_data = load_boundaries()
    
    print("üîç –ò–∑–≤–ª–µ–∫–∞—é –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º...\n")
    districts_by_region = extract_district_boundaries(geojson_data)
    
    print("\nüíæ –°–æ—Ö—Ä–∞–Ω—è—é —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã...\n")
    save_regional_files(districts_by_region)
    
    print("\n‚ú® –ì–æ—Ç–æ–≤–æ!")
    total_districts = sum(len(d) for d in districts_by_region.values())
    print(f"–í—Å–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞–π–æ–Ω–æ–≤: {total_districts}")

if __name__ == '__main__':
    main()